# ==============================================================================
# RENDER.YAML - Render Platform Configuration (Docker Hub)
# ==============================================================================
# PURPOSE:
#   - Render pulls pre-built Docker image from Docker Hub
#   - Faster deployments (no build time)
#   - Uses tested image from CI/CD pipeline
#
# FLOW:
#   1. GitHub Actions builds and pushes to Docker Hub
#   2. Render pulls the image from Docker Hub
#   3. Render deploys the container
#
# DOCUMENTATION:
#   https://render.com/docs/docker
# ==============================================================================

services:
  # Backend API Service (Docker Hub Image)
  - type: web
    name: todo-backend
    runtime: image
    plan: free                  # Change to 'starter' for production
    
    # Pull from Docker Hub
    image:
      url: docker.io/eternalnomad404/todo-backend2:latest
    
    # Runtime settings
    region: oregon              # Choose: oregon, frankfurt, singapore, ohio
    healthCheckPath: /api/health
    
    # Environment variables
    envVars:
      - key: NODE_ENV
        value: production
      - key: MONGODB_URI
        sync: false           # Set in Render dashboard (secret)
      - key: PORT
        sync: false           # Render sets this automatically

# ==============================================================================
# DEPLOYMENT PROCESS:
# 
# 1. You push to GitHub main branch
# 2. GitHub Actions runs tests (CI)
# 3. If tests pass → code is available on main
# 4. Render detects changes on main branch
# 5. Render builds using: npm ci
# 6. Render starts using: npm start
# 7. Render checks /api/health endpoint
# 8. If healthy → deployment succeeds
# 9. Traffic switches to new deployment
# 
# FAILURE MODES:
# 
# - If build fails → deployment aborted, old version keeps running
# - If health check fails → deployment aborted, old version keeps running
# - If app crashes → Render auto-restarts (up to retry limits)
# 
# WHERE TO CHECK LOGS:
# - Render Dashboard → Your Service → Logs tab
# - Build logs show npm ci output
# - Runtime logs show console.log output
# ==============================================================================
